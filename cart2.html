<!DOCTYPE html>
<html>
<head>
  <title>장바구니</title>
</head>
<style>
   
  body {
    font-family: Arial, sans-serif;
    background-color: #f7f7f7;
    padding: 20px;
  }

  h1 {
    color: #333;
    margin-bottom: 20px;
  }

  ul {
    list-style-type: none;
    padding: 0;
  }

  li {
    margin-bottom: 10px;
    padding: 10px;
    background-color: #fff;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  button {
    margin-left: 10px;
    padding: 5px 10px;
    border: none;
    background-color: #eee;
    color: #333;
    border-radius: 3px;
    cursor: pointer;
  }

  button:hover {
    background-color: #ccc;
  }

  #totalPrice {
    font-size: 18px;
    font-weight: bold;
    margin-top: 20px;
  }
</style>
<body>
    
  <h1>장바구니</h1>
  <ul id="cartItems">
    <!-- 여기에 각 상품의 누적 개수와 가격이 표시됩니다 -->
  </ul>
  <p id="totalPrice"></p>
  <button onclick="removeSelectedItems()">선택상품삭제</button>
  <script>
    // 장바구니 개수와 가격 표시 함수
    function displayCartItems() {
      var cartItems = JSON.parse(localStorage.getItem('cartItems'));

      if (cartItems && cartItems.length > 0) {
        var cartList = document.getElementById('cartItems');
        cartList.innerHTML = '';

        var countMap = {};
        var priceMap = {};
        var totalPrice = 0;

        // 각 상품의 누적 개수와 가격 계산
        cartItems.forEach(function(item) {
          countMap[item] = (countMap[item] || 0) + 1;
          priceMap[item] = (priceMap[item] || 0) + calculatePrice(item);
          totalPrice += calculatePrice(item);
        });

        // 누적 개수와 가격 표시
        Object.keys(countMap).forEach(function(item) {
          var li = document.createElement('li');
          
          // 체크박스 생성 및 설정
          var checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = item;
          checkbox.name = 'selectedItems';

          var label = document.createElement('label');
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(item));

          li.appendChild(label);

         
          // 수정: 개수와 가격 표시를 하나의 요소로 감싸기
          var quantityElement = document.createElement('span');
          quantityElement.textContent = ' (개수: ' + countMap[item] + ', 가격: ' + priceMap[item].toLocaleString() + '원)';
          li.appendChild(quantityElement);


          var deleteButton = document.createElement('button');
          deleteButton.textContent = '-';
          deleteButton.addEventListener('click', function() {
            removeFromCart(item); // 상품 삭제 함수 호출 시 해당 태그(li)를 전달
          });

          var addButton = document.createElement('button');
          addButton.textContent = '+';
          addButton.addEventListener('click', function() {
            increaseQuantity(item);
            displayCartItems();
          });

          li.appendChild(deleteButton);
          li.appendChild(addButton);
          cartList.appendChild(li);
        });

         // 총 가격 표시
         var totalText = '총 가격: ' + totalPrice.toLocaleString() + '원';
        var totalPriceElement = document.getElementById('totalPrice');
        totalPriceElement.textContent = totalText;

        
      }
    }

    // 각 상품의 가격 계산
    function calculatePrice(item) {
      // 여기에서 상품 가격 계산 로직을 구현합니다.
      // 예시로 고정된 가격을 사용하도록 했습니다.
      var price;

      switch (item) {
        case '전기밥솥':
          price = 50000;
          break;
        case '의자':
          price = 10000;
          break;
        case '노트북':
          price = 300000;
          break;
        case '청소기':
          price = 200000;
          break;
        default:
          price = 0;
          break;
      }

      return price;
    }

     // 상품 삭제 함수
function removeFromCart(item, listItem) {
  var cartItems = JSON.parse(localStorage.getItem('cartItems'));

  // 선택한 상품을 장바구니에서 제거
  var index = cartItems.indexOf(item);
  if (index > -1) {
    cartItems.splice(index, 1);
  }

  // 변경된 장바구니 정보를 로컬 스토리지에 저장
  localStorage.setItem('cartItems', JSON.stringify(cartItems));

  // 선택한 상품의 태그(li)를 삭제
  listItem.remove();

  // 장바구니 다시 표시
  displayCartItems();
}

// 선택한 상품 삭제 함수
function removeSelectedItems() {
  var selectedItems = document.getElementsByName('selectedItems');
  var cartItems = JSON.parse(localStorage.getItem('cartItems'));

  for (var i = 0; i < selectedItems.length; i++) {
    var checkbox = selectedItems[i];
    if (checkbox.checked) {
      var item = checkbox.value;

      // 선택한 상품을 장바구니에서 제거
      var index = cartItems.indexOf(item);
      if (index > -1) {
        cartItems.splice(index, 1);
      }

      // 선택한 상품의 체크박스 태그(li)를 삭제
      checkbox.parentNode.parentNode.remove();
    }
  }

  // 변경된 장바구니 정보를 로컬 스토리지에 저장
  localStorage.setItem('cartItems', JSON.stringify(cartItems));

  // 장바구니 다시 표시
  displayCartItems();
}

  

   
    
  // 상품 개수를 1씩 증가시키는 함수
  function addToCart(item) {
    var cartItems = JSON.parse(localStorage.getItem('cartItems'));

    if (!cartItems) {
      cartItems = []; // 장바구니가 비어있으면 빈 배열로 초기화
    }

    cartItems.push(item.toString());

    // 변경된 장바구니 정보를 로컬 스토리지에 저장
    localStorage.setItem('cartItems', JSON.stringify(cartItems));

    // 장바구니 다시 표시
    displayCartItems();
  }

  // + 버튼을 클릭했을 때 상품 개수를 1씩 증가시키는 함수
  function increaseQuantity(item) {
    addToCart(item); // 상품을 장바구니에 추가
  }



    // 페이지 로드 시 장바구니 개수와 가격 표시
    window.onload = function() {
      displayCartItems();
    }
  </script>
</body>
</html>